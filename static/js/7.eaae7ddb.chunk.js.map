{"version":3,"sources":["pages/virtuallist/data.ts","pages/virtuallist/index.tsx","pages/virtuallist/index.less"],"names":["Array","fill","map","i","k","id","avatar","title","content","VirtualList","useState","renderData","setRenderData","wrapperHeight","setWrapperHeight","startOffset","setStartOffset","start","setStart","virtualWrapper","useRef","virtual","visibleCount","useMemo","Math","ceil","end","renderHeight","length","visibleData","slice","min","useEffect","_data","wrapper","current","clientHeight","scrollEvent","useCallback","scrollTop","floor","dom","addEventListener","removeEventListener","className","styles","ref","style","height","max","transform","src","alt","module","exports"],"mappings":"6KAAe,MAAIA,MAAM,KAAMC,MAAK,GAAMC,KAAI,SAACC,EAAGC,GAAJ,MAAW,CACvDC,GAAID,EACJE,OAAQ,0DACRC,MAAOH,EACPI,QAASJ,M,OC4EIK,UA3EK,WAAO,IAAD,EACYC,mBAAuB,IADnC,mBACjBC,EADiB,KACLC,EADK,OAEkBF,mBAAS,GAF3B,mBAEjBG,EAFiB,KAEFC,EAFE,OAGcJ,mBAAS,GAHvB,mBAGjBK,EAHiB,KAGJC,EAHI,OAIEN,mBAAS,GAJX,mBAIjBO,EAJiB,KAIVC,EAJU,KAMlBC,EAAiBC,iBAAuB,MACxCC,EAAUD,iBAAuB,MACjCE,EAAeC,mBAAQ,kBAAMC,KAAKC,KAAKZ,EAH1B,MAGuD,CAACA,IACrEa,EAAMT,EAAQK,EAEdK,EAAeJ,mBAAQ,kBANV,GAMgBZ,EAAWiB,SAAqB,CAACjB,IAG9DkB,EAAcN,mBAAQ,kBAAMZ,EAAWmB,MAAMb,EAAOO,KAAKO,IAAIL,EAAKf,EAAWiB,WAAU,CAC3FjB,EACAM,EACAS,IAGFM,qBAAU,WACRpB,EAAcqB,EAAMH,MAAM,EAAGR,MAC5B,CAACA,IAEJU,qBAAU,WACR,IAAME,EAAUf,EAAegB,QAC3BD,GACFpB,EAAiBoB,EAAQE,gBAE1B,IAEH,IAAMC,EAAcC,uBAAY,WAAO,IAAD,IAC9BC,EAAS,oBAAGpB,EAAegB,eAAlB,aAAG,EAAwBI,iBAA3B,QAAwC,EACjDtB,EAAQO,KAAKgB,MAAMD,EA5BR,IA6BXb,EAAMT,EAAQK,EACpBJ,EAASD,GACLS,GAAOf,EAAWiB,QACpBhB,EAAcqB,EAAMH,MAAM,EAAGJ,EAAMJ,IAErCN,EAAeuB,KACd,CAAC5B,EAAYW,IAehB,OAbAU,qBAAU,WACR,IAAIS,EAAMtB,EAAegB,QAKzB,OAJAE,IACII,GACFA,EAAIC,iBAAiB,SAAUL,GAE1B,WACDI,GACFA,EAAIE,oBAAoB,SAAUN,MAGrC,CAACA,IAGF,cAAC,OAAD,UACE,sBAAKO,UAAWC,IAAO,wBAAyBC,IAAK3B,EAArD,UACE,qBAAKyB,UAAWC,IAAO,wBAAyBE,MAAO,CAAEC,OAAQxB,KAAKyB,IAAItB,EAAcd,EAAgB,MACxG,qBAAK+B,UAAWC,IAAO,gBAAiBC,IAAKzB,EAAS0B,MAAO,CAAEG,UAAU,cAAD,OAAgBnC,EAAhB,QAAxE,SACGc,EAAY3B,KAAI,gBAAGG,EAAH,EAAGA,GAAIE,EAAP,EAAOA,MAAOD,EAAd,EAAcA,OAAQE,EAAtB,EAAsBA,QAAtB,OACf,sBAAcoC,UAAWC,IAAO,qBAAhC,UACE,qBAAKD,UAAWC,IAAO,6BAA8BM,IAAK7C,EAAQ8C,IAAI,KACtE,sBAAKR,UAAWC,IAAO,8BAAvB,UACE,oBAAID,UAAWC,IAAO,4BAAtB,SAAoDtC,IACpD,qBAAKqC,UAAWC,IAAO,2BAAvB,SAAoDrC,SAJ9CH,e,oBCjEtBgD,EAAOC,QAAU,CAAC,uBAAuB,8BAA8B,uBAAuB,8BAA8B,eAAe,sBAAsB,oBAAoB,2BAA2B,4BAA4B,mCAAmC,6BAA6B,oCAAoC,2BAA2B","file":"static/js/7.eaae7ddb.chunk.js","sourcesContent":["export default new Array(1000).fill(true).map((i, k) => ({\n  id: k,\n  avatar: 'https://www.static.hellochange.cn/images/white_bear.gif',\n  title: k,\n  content: k,\n}));\n","import { Page } from '@/components';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport styles from './index.less';\nimport _data from './data';\n\nconst VirtualList = () => {\n  const [renderData, setRenderData] = useState<typeof _data>([]);\n  const [wrapperHeight, setWrapperHeight] = useState(0);\n  const [startOffset, setStartOffset] = useState(0);\n  const [start, setStart] = useState(0);\n  const itemHeight = 50;\n  const virtualWrapper = useRef<HTMLDivElement>(null);\n  const virtual = useRef<HTMLDivElement>(null);\n  const visibleCount = useMemo(() => Math.ceil(wrapperHeight / itemHeight), [wrapperHeight]);\n  const end = start + visibleCount;\n  // 已经更新的高度\n  const renderHeight = useMemo(() => renderData.length * itemHeight, [renderData]);\n\n  // 应该显示的列表数据\n  const visibleData = useMemo(() => renderData.slice(start, Math.min(end, renderData.length)), [\n    renderData,\n    start,\n    end,\n  ]);\n\n  useEffect(() => {\n    setRenderData(_data.slice(0, visibleCount));\n  }, [visibleCount]);\n\n  useEffect(() => {\n    const wrapper = virtualWrapper.current;\n    if (wrapper) {\n      setWrapperHeight(wrapper.clientHeight);\n    }\n  }, []);\n\n  const scrollEvent = useCallback(() => {\n    const scrollTop = virtualWrapper.current?.scrollTop ?? 0;\n    const start = Math.floor(scrollTop / itemHeight);\n    const end = start + visibleCount;\n    setStart(start);\n    if (end >= renderData.length) {\n      setRenderData(_data.slice(0, end + visibleCount));\n    }\n    setStartOffset(scrollTop);\n  }, [renderData, visibleCount]);\n\n  useEffect(() => {\n    let dom = virtualWrapper.current;\n    scrollEvent();\n    if (dom) {\n      dom.addEventListener('scroll', scrollEvent);\n    }\n    return () => {\n      if (dom) {\n        dom.removeEventListener('scroll', scrollEvent);\n      }\n    };\n  }, [scrollEvent]);\n\n  return (\n    <Page>\n      <div className={styles['virtual-list-wrapper']} ref={virtualWrapper}>\n        <div className={styles['virtual-list-phantom']} style={{ height: Math.max(renderHeight, wrapperHeight + 1) }} />\n        <div className={styles['virtual-list']} ref={virtual} style={{ transform: `translateY(${startOffset}px)` }}>\n          {visibleData.map(({ id, title, avatar, content }) => (\n            <div key={id} className={styles['virtual-list-item']}>\n              <img className={styles['virtual-list-item__avatar']} src={avatar} alt=\"\" />\n              <div className={styles['virtual-list-item__content']}>\n                <h3 className={styles['virtual-list-item__title']}>{title}</h3>\n                <div className={styles['virtual-list-item__desc']}>{content}</div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </Page>\n  );\n};\n\nexport default VirtualList;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"virtual-list-wrapper\":\"virtual-list-wrapper__2_yEZ\",\"virtual-list-phantom\":\"virtual-list-phantom__28vnd\",\"virtual-list\":\"virtual-list__3-Cdz\",\"virtual-list-item\":\"virtual-list-item__zfGx2\",\"virtual-list-item__avatar\":\"virtual-list-item__avatar__3Gux7\",\"virtual-list-item__content\":\"virtual-list-item__content__F8Fyt\",\"virtual-list-item__title\":\"virtual-list-item__title__2XtSX\"};"],"sourceRoot":""}